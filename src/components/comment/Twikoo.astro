---
import { commentConfig } from "@/config";

interface Props {
	path: string;
}

const config = {
	...commentConfig.twikoo,
	el: "#tcomment",
	path: Astro.props.path,
};
---

<div id="tcomment"></div>
<span id="twikoo_comments"></span>
<span id="twikoo_visitors"></span>

<script define:vars={{ config }}>
  function updateTwikooViews() {
    const commentsEl = document.getElementById('twikoo_comments');
    const visitorsEl = document.getElementById('twikoo_visitors');

    if (commentsEl) {
      const commentCountEl = document.querySelector('.tk-comments-count');
      const commentCount = commentCountEl ? 
        (commentCountEl.textContent.match(/\d+/)?.[0] || '0') : '0';
      commentsEl.textContent = commentCount;
    }

    if (visitorsEl) {
      visitorsEl.textContent = '0';
    }
  }

  function loadTwikoo() {
    const script = document.createElement("script");
    script.src = "https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.min.js";
    script.defer = true;
    script.onload = () => {
      twikoo.init({
        ...config
      });
      twikoo.ready(() => {
        updateTwikooViews();
      });
    };
    document.body.appendChild(script);
  }
  document.addEventListener("loadComment", loadTwikoo, { once: true });
</script>